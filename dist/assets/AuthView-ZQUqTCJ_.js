import{d as R,r as c,I,k as C,o as j,a as F,c as i,m,b as s,E as $,t as n,J as H,K as S,N as y,D as K,i as d,_ as q}from"./index-CJqd1CcK.js";import{C as z}from"./index-BLhjGCg8.js";const G={class:"auth-container"},Q={key:0,class:"modal-overlay"},W={class:"login-prompt-modal"},X={class:"modal-title"},Y={class:"auth-form"},Z={class:"title"},ee={key:0,class:"error-message general-error"},se={class:"form-group"},oe={key:0,class:"error-message"},te={class:"form-group"},re={key:0,class:"error-message"},ae={key:0,class:"form-group"},ne={key:0,class:"error-message"},le={type:"submit",class:"submit-button"},ie={class:"toggle-auth"},de={key:1,class:"modal-overlay"},ue={class:"success-modal"},ce={class:"modal-title"},me=R({__name:"AuthView",setup(pe){const L=K(),l=c(!0),g=c(!1),v=c(!1),w=c(""),P=c(""),u=c(null),p=c("/"),o=I({username:"",password:"",confirmPassword:""}),t=I({username:"",password:"",confirmPassword:"",general:""}),T=C(()=>l.value?"登录":"注册"),U=C(()=>l.value?"还没有账号？去注册":"已有账号？去登录");j(()=>{const r=localStorage.getItem("redirectAfterLogin");r&&(p.value=r),localStorage.getItem("showLoginPrompt")==="true"&&(v.value=!0,P.value="尊敬的用户，您访问的功能需要登录后才能使用。请注册或登录以继续访问。",localStorage.removeItem("showLoginPrompt"))});const V=()=>{l.value=!l.value,N()},M=()=>{v.value=!1},N=()=>{o.username="",o.password="",o.confirmPassword="",b()},b=()=>{t.username="",t.password="",t.confirmPassword="",t.general=""},A=()=>{b();let r=!0;return o.username?o.username.length<3&&(t.username="用户名长度不能少于3个字符",r=!1):(t.username="请输入用户名",r=!1),o.password?o.password.length<6&&(t.password="密码长度不能少于6个字符",r=!1):(t.password="请输入密码",r=!1),l.value||(o.confirmPassword?o.password!==o.confirmPassword&&(t.confirmPassword="两次输入的密码不一致",r=!1):(t.confirmPassword="请再次输入密码",r=!1)),r},k=r=>z.SHA256(r).toString(),x=()=>{window.dispatchEvent(new Event("user-state-changed"))},J=()=>{A()&&(l.value?E():O())},E=()=>{const e=JSON.parse(localStorage.getItem("users")||"[]").find(D=>D.username===o.username);if(!e){t.general="用户不存在";return}const a=k(o.password);if(e.password!==a){t.general="密码错误";return}const h={username:e.username,isLoggedIn:!0};localStorage.setItem("currentUser",JSON.stringify(h)),x();const _=p.value!=="/"?"之前访问的页面":"首页";w.value=`登录成功，即将跳转到${_}...`,g.value=!0,u.value=setTimeout(()=>{f()},3e3)},f=()=>{const r=p.value;localStorage.removeItem("redirectAfterLogin"),p.value="/",L.push(r)},O=()=>{const r=JSON.parse(localStorage.getItem("users")||"[]");if(r.some(_=>_.username===o.username)){t.username="该用户名已被使用";return}const e={username:o.username,password:k(o.password),createdAt:new Date().toISOString()};r.push(e),localStorage.setItem("users",JSON.stringify(r));const a={username:e.username,isLoggedIn:!0};localStorage.setItem("currentUser",JSON.stringify(a)),x();const h=p.value!=="/"?"之前访问的页面":"首页";w.value=`注册成功，即将跳转到${h}...`,g.value=!0,u.value=setTimeout(()=>{f()},3e3)};F(()=>{u.value&&clearTimeout(u.value)});const B=()=>{g.value=!1,u.value&&(clearTimeout(u.value),u.value=null),f()};return(r,e)=>(d(),i("div",G,[v.value?(d(),i("div",Q,[s("div",W,[e[3]||(e[3]=$('<div class="modal-icon warning" data-v-bee9d7ed><svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-bee9d7ed><circle cx="12" cy="12" r="10" data-v-bee9d7ed></circle><line x1="12" y1="8" x2="12" y2="12" data-v-bee9d7ed></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-bee9d7ed></line></svg></div>',1)),s("h3",X,n(P.value),1),s("button",{class:"modal-button",onClick:M}," 我知道了 ")])])):m("",!0),s("div",Y,[s("h1",Z,n(l.value?"登录账户":"创建新账户"),1),t.general?(d(),i("div",ee,n(t.general),1)):m("",!0),s("form",{onSubmit:H(J,["prevent"])},[s("div",se,[e[4]||(e[4]=s("label",{for:"username"},"用户名",-1)),S(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=a=>o.username=a),type:"text",placeholder:"请输入用户名",autocomplete:"username"},null,512),[[y,o.username]]),t.username?(d(),i("div",oe,n(t.username),1)):m("",!0)]),s("div",te,[e[5]||(e[5]=s("label",{for:"password"},"密码",-1)),S(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>o.password=a),type:"password",placeholder:"请输入密码",autocomplete:"current-password"},null,512),[[y,o.password]]),t.password?(d(),i("div",re,n(t.password),1)):m("",!0)]),l.value?m("",!0):(d(),i("div",ae,[e[6]||(e[6]=s("label",{for:"confirmPassword"},"确认密码",-1)),S(s("input",{id:"confirmPassword","onUpdate:modelValue":e[2]||(e[2]=a=>o.confirmPassword=a),type:"password",placeholder:"请再次输入密码",autocomplete:"new-password"},null,512),[[y,o.confirmPassword]]),t.confirmPassword?(d(),i("div",ne,n(t.confirmPassword),1)):m("",!0)])),s("button",le,n(T.value),1)],32),s("div",ie,[s("button",{onClick:V,class:"toggle-button"},n(U.value),1)])]),g.value?(d(),i("div",de,[s("div",ue,[e[7]||(e[7]=s("div",{class:"modal-icon"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),s("polyline",{points:"22 4 12 14.01 9 11.01"})])],-1)),s("h3",ce,n(w.value),1),s("button",{class:"modal-button",onClick:B}," 立即前往 ")])])):m("",!0)]))}}),we=q(me,[["__scopeId","data-v-bee9d7ed"]]);export{we as default};
