import{d as C,r as e,y as P,c as k,b as t,h as f,f as u,_ as x,o as M,p as S,u as N,q as V,i as c,t as o,e as I,x as D,k as T,l as w,m as $,F,j as R}from"./index-DX20QISl.js";import"@element-plus/icons-vue";const X={class:"map-container"},q={key:0,class:"map-footer"},L=C({__name:"MapComponentFixed",props:{isDrawing:{type:Boolean,default:!1},taskAreaPoints:{type:Array,default:()=>[]},showDroneInfo:{type:Boolean,default:!0}},emits:["update:droneInfo","update:taskAreaPoints","update:taskAreaScreenshot"],setup(m,{expose:y,emit:a}){const l=m,_=e(null),h=e([116.397428,39.90923]);e("normal"),e([[116.386037,39.913122],[116.389684,39.904507],[116.405563,39.90654],[116.401787,39.915309],[116.386037,39.913122]]),P({id:"Drone-X10",status:"执行任务中",battery:78,altitude:120,speed:36,signal:98}),e(null),e(null),e([]),e(null),e([]),e(null),e(null),e(!1),e([116.397428,39.90923]),e([]),e(null),e([]),e(null),y({updateDronePosition:p,getCurrentMap:b});const p=(g,d,r)=>{_.value&&(h.value=g,droneHeight.value=d,droneRotation.value=r,updateDroneMarker())},b=()=>_.value;return(g,d)=>(u(),k("div",X,[d[0]||(d[0]=t("div",{class:"map-header"},[t("h2",null,"实时地图"),t("div",{class:"map-controls"})],-1)),d[1]||(d[1]=t("div",{id:"amap-container",class:"amap-container"},null,-1)),l.showDroneInfo?(u(),k("div",q)):f("",!0)]))}}),U=x(L,[["__scopeId","data-v-16befe67"]]);function j(){try{if(!window.map){console.warn("地图实例不存在，无法清除点位");return}window.droneMarker&&(window.map.remove(window.droneMarker),window.droneMarker=null),window.polygons&&window.polygons.length>0&&(window.map.remove(window.polygons),window.polygons=[]),window.markers&&window.markers.length>0&&(window.map.remove(window.markers),window.markers=[]),console.log("成功清除地图上所有点位和多边形")}catch(m){console.error("清除地图点位时发生错误:",m)}}const z={class:"drone-task-detail"},E={class:"task-sidebar"},G={class:"header"},H={class:"task-info"},J={class:"info-item"},K={class:"value"},O={class:"info-item"},Q={class:"value"},W={class:"info-item"},Y={class:"value"},Z={class:"info-item"},tt={class:"value"},st={class:"info-item"},et={class:"value"},at={class:"info-item"},nt={class:"value status"},ot={class:"drone-info"},lt={class:"drone-card"},it={class:"drone-header"},dt={class:"drone-name"},rt={class:"drone-stats"},ut={class:"stat-item"},vt={class:"stat-value"},ct={class:"stat-item"},pt={class:"stat-value"},mt={class:"stat-item"},_t={class:"stat-value"},gt={class:"stat-item"},wt={class:"stat-value"},ft={class:"action-buttons"},kt={class:"map-container"},yt={class:"map-header"},ht={class:"map-controls"},bt={class:"map-type-selector"},Dt=["onClick"],Mt={class:"map-wrapper"},It=C({__name:"DroneTaskDetailView",setup(m){const y=V(),a=e({id:"DRN-2023-0542",name:"东部湿地公园巡检",type:"区域巡检",startTime:"2023-11-08 14:30",endTime:"2023-11-08 17:30",area:"湿地保护区东区",status:"running",droneId:"Drone-X10",droneName:"SkyGuard X10",droneBattery:78,droneSignal:87,droneAltitude:120,droneSpeed:15,batteryLevel:"78% (约2小时15分)",signalStrength:"87% (良好)"});e([{id:"A",type:"person",name:"人群聚集点A",description:"约45人，活动正常",position:{lng:116.393428,lat:39.91123},status:"normal"},{id:"B",type:"traffic",name:"交通监控点B",description:"车流量中等，无拥堵",position:{lng:116.397428,lat:39.90623},status:"normal"},{id:"C",type:"warning",name:"重点区域C",description:"检测到异常活动，建议关注",position:{lng:116.401428,lat:39.90923},status:"warning"},{id:"D",type:"parking",name:"车辆集中点D",description:"停放正常，车位充足",position:{lng:116.395428,lat:39.90523},status:"normal"}]);const l=e({lng:116.397428,lat:39.90923});e(null);const _=[{value:"standard",label:"标准地图"},{value:"satellite",label:"卫星模式"},{value:"3d",label:"3D图像"},{value:"heatmap",label:"热力图"}],h=e("标准地图"),p=e("standard"),b=n=>{h.value=n,p.value=n,console.log("切换地图类型:",n)},g=n=>{switch(n){case"waiting":return"等待中";case"running":return"执行中";case"completed":return"已完成";case"failed":return"失败";default:return"未知"}},d=n=>{console.log("更新任务区域点:",n)};M(()=>{console.log("组件挂载，清理地图点"),setTimeout(()=>{try{j()}catch(n){console.error("清理地图点失败:",n)}},1e3)}),S(()=>{r!==null&&clearInterval(r)});let r=null;const A=()=>{r!==null&&clearInterval(r);let n=0;const s=[{lng:116.386037,lat:39.913122},{lng:116.389684,lat:39.904507},{lng:116.405563,lat:39.90654},{lng:116.401787,lat:39.915309},{lng:116.393428,lat:39.91123},{lng:116.397428,lat:39.90623},{lng:116.401428,lat:39.90923},{lng:116.395428,lat:39.90523}];r=window.setInterval(()=>{const i=s[n];l.value={lng:l.value.lng+(i.lng-l.value.lng)*.1,lat:l.value.lat+(i.lat-l.value.lat)*.1},Math.sqrt(Math.pow(l.value.lng-i.lng,2)+Math.pow(l.value.lat-i.lat,2))<2e-4&&(n=(n+1)%s.length),B()},500)},B=()=>{window.map&&window.droneMarker&&window.droneMarker.setPosition(l.value)};return M(()=>{setTimeout(()=>{A()},2e3)}),(n,s)=>{const i=$("el-button");return u(),k("div",z,[t("div",E,[t("div",G,[t("div",{class:"back-button",onClick:s[0]||(s[0]=v=>N(y).push("/dashboard"))},s[1]||(s[1]=[t("i",{class:"el-icon-arrow-left"},null,-1),c(" 返回 ")])),s[2]||(s[2]=t("div",{class:"title"},"任务详情",-1))]),t("div",H,[t("div",J,[s[3]||(s[3]=t("div",{class:"label"},"任务ID",-1)),t("div",K,o(a.value.id),1)]),t("div",O,[s[4]||(s[4]=t("div",{class:"label"},"任务名称",-1)),t("div",Q,o(a.value.name),1)]),t("div",W,[s[5]||(s[5]=t("div",{class:"label"},"开始时间",-1)),t("div",Y,o(a.value.startTime),1)]),t("div",Z,[s[6]||(s[6]=t("div",{class:"label"},"任务区域",-1)),t("div",tt,o(a.value.area),1)]),t("div",st,[s[7]||(s[7]=t("div",{class:"label"},"任务类型",-1)),t("div",et,o(a.value.type),1)]),t("div",at,[s[8]||(s[8]=t("div",{class:"label"},"任务状态",-1)),t("div",nt,[t("span",{class:I(["status-dot",a.value.status])},null,2),c(" "+o(g(a.value.status)),1)])])]),t("div",ot,[s[14]||(s[14]=t("div",{class:"section-title"},"执行无人机",-1)),t("div",lt,[t("div",it,[s[9]||(s[9]=t("img",{src:"",alt:"无人机",class:"drone-image"},null,-1)),t("div",dt,o(a.value.droneName),1)]),t("div",rt,[t("div",ut,[s[10]||(s[10]=t("div",{class:"stat-icon battery"},null,-1)),t("div",vt,o(a.value.droneBattery)+"%",1)]),t("div",ct,[s[11]||(s[11]=t("div",{class:"stat-icon signal"},null,-1)),t("div",pt,o(a.value.droneSignal)+"%",1)]),t("div",mt,[s[12]||(s[12]=t("div",{class:"stat-icon altitude"},null,-1)),t("div",_t,o(a.value.droneAltitude)+"m",1)]),t("div",gt,[s[13]||(s[13]=t("div",{class:"stat-icon speed"},null,-1)),t("div",wt,o(a.value.droneSpeed)+"km/h",1)])])])]),t("div",ft,[a.value.status==="waiting"?(u(),D(i,{key:0,type:"primary"},{default:w(()=>s[15]||(s[15]=[c("开始任务")])),_:1})):f("",!0),a.value.status==="running"?(u(),D(i,{key:1,type:"danger"},{default:w(()=>s[16]||(s[16]=[c("终止任务")])),_:1})):f("",!0),a.value.status==="running"?(u(),D(i,{key:2,type:"info"},{default:w(()=>s[17]||(s[17]=[c("暂停任务")])),_:1})):f("",!0),T(i,null,{default:w(()=>s[18]||(s[18]=[c("导出报告")])),_:1})])]),t("div",kt,[t("div",yt,[s[19]||(s[19]=t("div",{class:"map-title"},"实时监控",-1)),t("div",ht,[t("div",bt,[(u(),k(F,null,R(_,v=>t("div",{key:v.value,class:I(["type-item",{active:p.value===v.value}]),onClick:Tt=>b(v.value)},o(v.label),11,Dt)),64))])])]),t("div",Mt,[T(U,{"task-type":p.value,"drone-position":l.value,"onUpdate:taskAreaPoints":d},null,8,["task-type","drone-position"])])])])}}}),At=x(It,[["__scopeId","data-v-218ac72e"]]);export{At as default};
