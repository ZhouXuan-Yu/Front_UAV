import{d as z,r as w,I as U,o as G,D as H,c as l,b as e,m as i,h as f,J as K,n as O,t as c,e as N,K as v,N as m,O as L,E as j,B as q,i as n,_ as Q}from"./index-CJqd1CcK.js";import{C as W}from"./index-BLhjGCg8.js";const X={class:"profile-container"},Y={class:"profile-header"},Z={class:"breadcrumb"},ee={class:"profile-content"},se={class:"profile-sidebar"},ae={class:"avatar-section"},oe={key:0},te={key:0},re={class:"sidebar-nav"},le={class:"profile-main"},ne={key:0,class:"success-message"},ie={key:1,class:"error-message"},de={key:2,class:"profile-section"},ue={class:"section-header"},ce={class:"form-container"},ve={class:"form-group"},me={class:"form-group"},pe=["disabled"],fe={key:0,class:"error-hint"},be={class:"form-group"},we=["disabled"],ge={class:"form-group"},Pe=["disabled"],ye={class:"form-group"},ke=["disabled"],he={class:"form-group"},_e=["disabled"],Ce={class:"form-group"},Se={class:"avatar-upload"},Ue={key:0},Ne={key:1,for:"avatar",class:"upload-button"},Ie={key:0,class:"form-actions"},Ve={key:3,class:"profile-section"},xe={class:"section-header"},De={class:"form-container"},Je={class:"form-group"},Me=["disabled"],Oe={key:0,class:"error-hint"},Ae={class:"form-group"},$e=["disabled"],Be={key:0,class:"error-hint"},Ee={class:"form-group"},Fe=["disabled"],Te={key:0,class:"form-actions"},Re={key:4,class:"profile-section"},ze={key:0,class:"modal-overlay"},Ge={class:"modal"},He={key:0,class:"error-message modal-error"},Ke={class:"modal-body"},Le={class:"form-group"},je={key:0,class:"error-hint"},qe={class:"form-group"},Qe={key:0,class:"error-hint"},We={class:"form-group"},Xe={key:0,class:"error-hint"},Ye={key:1,class:"modal-overlay"},Ze=z({__name:"ProfileView",setup(es){const k=H(),g=w("basic"),d=w(!1),h=w(!1),_=w(!1),b=w(""),p=w(""),y=w(null),I=w(null),a=U({username:"",nickname:"",realName:"",gender:"",birthdate:"",email:"",phone:"",address:"",bio:"",avatar:""}),u=U({currentPassword:"",newPassword:"",confirmPassword:""}),r=U({general:"",nickname:"",email:"",phone:"",currentPassword:"",newPassword:"",confirmPassword:""});G(()=>{V()});const V=()=>{const t=localStorage.getItem("currentUser");if(!t){k.push("/auth");return}try{y.value=JSON.parse(t);const o=JSON.parse(localStorage.getItem("users")||"[]").find(P=>P.username===y.value.username);o&&(I.value={...o},a.username=o.username||"",a.nickname=o.nickname||"",a.realName=o.realName||"",a.gender=o.gender||"",a.birthdate=o.birthdate||"",a.email=o.email||"",a.phone=o.phone||"",a.address=o.address||"",a.bio=o.bio||"",a.avatar=o.avatar||"")}catch(s){console.error("解析用户数据出错:",s),k.push("/auth")}},C=()=>{d.value&&V(),d.value=!d.value,p.value="",b.value=""},S=t=>{g.value=t,p.value="",b.value=""},A=()=>{let t=!0;return r.general="",r.nickname="",r.email="",r.phone="",a.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)&&(r.email="请输入有效的电子邮件地址",t=!1),a.phone&&!/^1[3-9]\d{9}$/.test(a.phone)&&(r.phone="请输入有效的手机号码",t=!1),t},$=()=>{let t=!0;return r.currentPassword="",r.newPassword="",r.confirmPassword="",r.general="",u.currentPassword||(r.currentPassword="请输入当前密码",t=!1),u.newPassword?u.newPassword.length<6&&(r.newPassword="密码长度不能少于6个字符",t=!1):(r.newPassword="请输入新密码",t=!1),u.confirmPassword?u.newPassword!==u.confirmPassword&&(r.confirmPassword="两次输入的密码不一致",t=!1):(r.confirmPassword="请确认新密码",t=!1),t},x=()=>{if(A())try{const t=JSON.parse(localStorage.getItem("users")||"[]"),s=t.findIndex(o=>o.username===y.value.username);if(s>=0){const o={...t[s],nickname:a.nickname,realName:a.realName,gender:a.gender,birthdate:a.birthdate,email:a.email,phone:a.phone,address:a.address,bio:a.bio,avatar:a.avatar,updatedAt:new Date().toISOString()};t[s]=o,localStorage.setItem("users",JSON.stringify(t)),I.value={...o},b.value="个人信息已成功更新",p.value="",d.value=!1}else p.value="用户不存在，请重新登录",b.value=""}catch(t){console.error("保存用户数据出错:",t),p.value="保存失败，请稍后再试",b.value=""}},D=t=>W.SHA256(t).toString(),B=()=>{h.value=!0,u.currentPassword="",u.newPassword="",u.confirmPassword="",r.currentPassword="",r.newPassword="",r.confirmPassword="",r.general=""},J=()=>{h.value=!1},E=()=>{if($())try{const t=JSON.parse(localStorage.getItem("users")||"[]"),s=t.findIndex(o=>o.username===y.value.username);if(s>=0){const o=D(u.currentPassword);if(t[s].password!==o){r.currentPassword="当前密码不正确";return}const P=D(u.newPassword);t[s].password=P,t[s].updatedAt=new Date().toISOString(),localStorage.setItem("users",JSON.stringify(t)),h.value=!1,b.value="密码已成功修改",p.value=""}else r.general="用户不存在，请重新登录"}catch(t){console.error("修改密码出错:",t),r.general="修改失败，请稍后再试"}},F=()=>{_.value=!0},M=()=>{_.value=!1},T=()=>{try{const s=JSON.parse(localStorage.getItem("users")||"[]").filter(o=>o.username!==y.value.username);localStorage.setItem("users",JSON.stringify(s)),localStorage.removeItem("currentUser"),k.push("/auth")}catch(t){console.error("删除账户出错:",t),p.value="删除失败，请稍后再试",_.value=!1}},R=t=>{const s=t.target.files[0];if(s&&s.type.match("image.*")){const o=new FileReader;o.onload=P=>{P.target&&P.target.result&&(a.avatar=P.target.result.toString())},o.readAsDataURL(s)}};return(t,s)=>(n(),l("div",X,[e("div",Y,[e("div",Z,[e("a",{href:"/",onClick:s[0]||(s[0]=K(o=>q(k).push("/"),["prevent"]))},"首页"),s[16]||(s[16]=f(" > ")),s[17]||(s[17]=e("span",null,"个人中心",-1))]),s[18]||(s[18]=e("h1",null,"个人资料",-1)),s[19]||(s[19]=e("p",{class:"subtitle"},"管理您的个人信息和账户安全",-1))]),e("div",ee,[e("div",se,[e("div",ae,[e("div",{class:"avatar",style:O({backgroundImage:a.avatar?`url(${a.avatar})`:"none"})},[a.avatar?i("",!0):(n(),l("span",oe,c(a.username?a.username.charAt(0).toUpperCase():"U"),1))],4),e("h3",null,c(a.nickname||a.username),1),a.email?(n(),l("p",te,c(a.email),1)):i("",!0)]),e("div",re,[e("button",{onClick:s[1]||(s[1]=o=>S("basic")),class:N({active:g.value==="basic"})}," 基本信息 ",2),e("button",{onClick:s[2]||(s[2]=o=>S("contact")),class:N({active:g.value==="contact"})}," 联系方式 ",2),e("button",{onClick:s[3]||(s[3]=o=>S("security")),class:N({active:g.value==="security"})}," 安全设置 ",2)])]),e("div",le,[b.value?(n(),l("div",ne,c(b.value),1)):i("",!0),p.value?(n(),l("div",ie,c(p.value),1)):i("",!0),g.value==="basic"?(n(),l("div",de,[e("div",ue,[s[20]||(s[20]=e("h2",null,"基本信息",-1)),e("button",{onClick:C,class:"edit-button"},c(d.value?"取消":"编辑"),1)]),e("div",ce,[e("div",ve,[s[21]||(s[21]=e("label",{for:"username"},"用户名",-1)),v(e("input",{id:"username","onUpdate:modelValue":s[4]||(s[4]=o=>a.username=o),type:"text",disabled:"",class:"readonly-input"},null,512),[[m,a.username]]),s[22]||(s[22]=e("span",{class:"field-hint"},"用户名不可修改",-1))]),e("div",me,[s[23]||(s[23]=e("label",{for:"nickname"},"昵称",-1)),v(e("input",{id:"nickname","onUpdate:modelValue":s[5]||(s[5]=o=>a.nickname=o),type:"text",disabled:!d.value,placeholder:"设置一个昵称"},null,8,pe),[[m,a.nickname]]),r.nickname?(n(),l("div",fe,c(r.nickname),1)):i("",!0)]),e("div",be,[s[24]||(s[24]=e("label",{for:"realName"},[f("真实姓名 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("input",{id:"realName","onUpdate:modelValue":s[6]||(s[6]=o=>a.realName=o),type:"text",disabled:!d.value,placeholder:"填写您的真实姓名"},null,8,we),[[m,a.realName]])]),e("div",ge,[s[26]||(s[26]=e("label",{for:"gender"},[f("性别 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("select",{id:"gender","onUpdate:modelValue":s[7]||(s[7]=o=>a.gender=o),disabled:!d.value},s[25]||(s[25]=[j('<option value="" data-v-960a1a29>请选择</option><option value="male" data-v-960a1a29>男</option><option value="female" data-v-960a1a29>女</option><option value="other" data-v-960a1a29>其他</option><option value="private" data-v-960a1a29>不愿透露</option>',5)]),8,Pe),[[L,a.gender]])]),e("div",ye,[s[27]||(s[27]=e("label",{for:"birthdate"},[f("出生日期 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("input",{id:"birthdate","onUpdate:modelValue":s[8]||(s[8]=o=>a.birthdate=o),type:"date",disabled:!d.value},null,8,ke),[[m,a.birthdate]])]),e("div",he,[s[28]||(s[28]=e("label",{for:"bio"},[f("个人简介 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("textarea",{id:"bio","onUpdate:modelValue":s[9]||(s[9]=o=>a.bio=o),disabled:!d.value,placeholder:"介绍一下自己...",rows:"4"},null,8,_e),[[m,a.bio]])]),e("div",Ce,[s[30]||(s[30]=e("label",{for:"avatar"},[f("头像 "),e("span",{class:"optional"},"(可选)")],-1)),e("div",Se,[e("div",{class:"preview-avatar",style:O({backgroundImage:a.avatar?`url(${a.avatar})`:"none"})},[a.avatar?i("",!0):(n(),l("span",Ue,c(a.username?a.username.charAt(0).toUpperCase():"U"),1))],4),d.value?(n(),l("input",{key:0,id:"avatar",type:"file",accept:"image/*",onChange:R,class:"file-input"},null,32)):i("",!0),d.value?(n(),l("label",Ne,"选择图片")):i("",!0),s[29]||(s[29]=e("p",{class:"field-hint"},"支持 JPG、PNG 格式，文件大小不超过 2MB",-1))])]),d.value?(n(),l("div",Ie,[e("button",{onClick:C,class:"cancel-button"},"取消"),e("button",{onClick:x,class:"save-button"},"保存")])):i("",!0)])])):i("",!0),g.value==="contact"?(n(),l("div",Ve,[e("div",xe,[s[31]||(s[31]=e("h2",null,"联系方式",-1)),e("button",{onClick:C,class:"edit-button"},c(d.value?"取消":"编辑"),1)]),e("div",De,[e("div",Je,[s[32]||(s[32]=e("label",{for:"email"},"电子邮箱",-1)),v(e("input",{id:"email","onUpdate:modelValue":s[10]||(s[10]=o=>a.email=o),type:"email",disabled:!d.value,placeholder:"填写您的邮箱地址"},null,8,Me),[[m,a.email]]),r.email?(n(),l("div",Oe,c(r.email),1)):i("",!0),s[33]||(s[33]=e("span",{class:"field-hint"},"用于接收通知和找回密码",-1))]),e("div",Ae,[s[34]||(s[34]=e("label",{for:"phone"},[f("手机号码 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("input",{id:"phone","onUpdate:modelValue":s[11]||(s[11]=o=>a.phone=o),type:"tel",disabled:!d.value,placeholder:"填写您的手机号码"},null,8,$e),[[m,a.phone]]),r.phone?(n(),l("div",Be,c(r.phone),1)):i("",!0),s[35]||(s[35]=e("span",{class:"field-hint"},"用于接收重要通知和验证码",-1))]),e("div",Ee,[s[36]||(s[36]=e("label",{for:"address"},[f("地址 "),e("span",{class:"optional"},"(可选)")],-1)),v(e("textarea",{id:"address","onUpdate:modelValue":s[12]||(s[12]=o=>a.address=o),disabled:!d.value,placeholder:"填写您的详细地址",rows:"3"},null,8,Fe),[[m,a.address]])]),d.value?(n(),l("div",Te,[e("button",{onClick:C,class:"cancel-button"},"取消"),e("button",{onClick:x,class:"save-button"},"保存")])):i("",!0)])])):i("",!0),g.value==="security"?(n(),l("div",Re,[s[39]||(s[39]=e("div",{class:"section-header"},[e("h2",null,"安全设置")],-1)),e("div",{class:"security-container"},[e("div",{class:"security-item"},[s[37]||(s[37]=e("div",{class:"security-info"},[e("h3",null,"登录密码"),e("p",null,"用于保护账号安全，建议定期更换")],-1)),e("button",{onClick:B,class:"action-button"},"修改密码")]),e("div",{class:"security-item"},[s[38]||(s[38]=e("div",{class:"security-info"},[e("h3",null,"账号注销"),e("p",null,"永久删除您的账户和所有相关数据")],-1)),e("button",{onClick:F,class:"delete-button"},"删除账户")])])])):i("",!0)])]),h.value?(n(),l("div",ze,[e("div",Ge,[e("div",{class:"modal-header"},[s[40]||(s[40]=e("h3",null,"修改密码",-1)),e("button",{onClick:J,class:"close-button"},"×")]),r.general?(n(),l("div",He,c(r.general),1)):i("",!0),e("div",Ke,[e("div",Le,[s[41]||(s[41]=e("label",{for:"currentPassword"},"当前密码",-1)),v(e("input",{id:"currentPassword","onUpdate:modelValue":s[13]||(s[13]=o=>u.currentPassword=o),type:"password",placeholder:"输入当前密码"},null,512),[[m,u.currentPassword]]),r.currentPassword?(n(),l("div",je,c(r.currentPassword),1)):i("",!0)]),e("div",qe,[s[42]||(s[42]=e("label",{for:"newPassword"},"新密码",-1)),v(e("input",{id:"newPassword","onUpdate:modelValue":s[14]||(s[14]=o=>u.newPassword=o),type:"password",placeholder:"输入新密码"},null,512),[[m,u.newPassword]]),r.newPassword?(n(),l("div",Qe,c(r.newPassword),1)):i("",!0),s[43]||(s[43]=e("span",{class:"field-hint"},"密码长度至少6位，建议使用字母、数字和特殊字符组合",-1))]),e("div",We,[s[44]||(s[44]=e("label",{for:"confirmPassword"},"确认新密码",-1)),v(e("input",{id:"confirmPassword","onUpdate:modelValue":s[15]||(s[15]=o=>u.confirmPassword=o),type:"password",placeholder:"再次输入新密码"},null,512),[[m,u.confirmPassword]]),r.confirmPassword?(n(),l("div",Xe,c(r.confirmPassword),1)):i("",!0)])]),e("div",{class:"modal-footer"},[e("button",{onClick:J,class:"cancel-button"},"取消"),e("button",{onClick:E,class:"save-button"},"确认修改")])])])):i("",!0),_.value?(n(),l("div",Ye,[e("div",{class:"modal"},[e("div",{class:"modal-header"},[s[45]||(s[45]=e("h3",null,"删除账户",-1)),e("button",{onClick:M,class:"close-button"},"×")]),s[46]||(s[46]=e("div",{class:"modal-body"},[e("div",{class:"confirm-message warning"},[e("p",null,[e("strong",null,"警告："),f(" 此操作将永久删除您的账户和所有相关数据，且无法恢复。")]),e("p",null,"确定要继续吗？")])],-1)),e("div",{class:"modal-footer"},[e("button",{onClick:M,class:"cancel-button"},"取消"),e("button",{onClick:T,class:"delete-button"},"确认删除")])])])):i("",!0)]))}}),os=Q(Ze,[["__scopeId","data-v-960a1a29"]]);export{os as default};
